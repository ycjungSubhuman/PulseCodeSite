{% extends "base_sidebar.html" %}

{% block scrollbar %}
	<div class="navbar navbar-inverse" id='typetab' role="navigation">
		<ul class="nav navbar-nav">
			<li id="new" style="font-weight:bold;"><a href="#">New</a></li>
			<li id="liked"><a href="#">Liked</a></li>
			<li id="scraped"><a href="#">Scraped</a></li>
		</ul>
	</div>
	<div id="linefeed">
	</div>

{% endblock scrollbar %}

{% block content %}
{{ block.super }}
	<input id="start_from" value="0" hidden/>
	<input id="type" value="new" hidden/>
{% endblock content %}


{% block style %}
{{ block.super }}
<style>
	#typetab {
		border: 0px;
		border-bottom: solid 2px #555555;
		height: 40px;
	}
	#typetab > ul > li {
		font-size: 15pt;

	}
	#linefeed {
	}
	.entity {
		background-color: #ffffff;
		height: 250px;
		margin: 20px;
	}
</style>

{% endblock style %}


{% block script %}
{{ block.super }}
<script>
	function getResult(){
		//get where to start
		var startfrom = $('#start_from').val();
		var type = $('#type').val();
		//ajax call
		$.ajax({
			type: "POST",
			url: '{% url "home:home" %}',
			data: {
				'isscroll': true,
				'startfrom': startfrom,
				'type': type,
			},
			success: function(data){
				/*---adjust div height---*/
				var entitynum = data.entitynum;
				var entityheight = 270;
				var height_added = entitynum * 200;
				var content_height = (startfrom == 0) ? entitynum*entityheight:$('#content').css('height')+entitynum*entityheight;

				$('#content').css('height', content_height);//set contentdiv height
				$(window).trigger('page:appended');//set inner div height

				/*---create DOMs and append them---*/
				for(var i in data.entity){
					$('<div></div>', {
						class: 'entity entity-journal',
						id: 'entity' + startfrom + i,
					}).appendTo('#linefeed')
				}

			},
			failure: function(data){

			},
		});
	}
	function setContentHeight(height){

	}
	$(document).ready(function(){
		$.ajaxSetup({
			headers: {'X-CSRFToken': getCookie("csrftoken")}
		});

		//on load, get 8 entities from the server
		getResult()

		
		$(window).scroll(function(e){//scroll loading event

			//if page has reached the bottom, load more docs
			if($(window).scrollTop()+$(window).height() >= ($(document).height()-50)){
				getResult();
			}

		});
		 $(window).on('page:appended', function(e){
		 	//set div heigth according to #content
		 	var height_content = $('#content').css('height');
		 	$('#scrollbar').css('height', height_content);
		 	$('#sidebar').css({
		 		'height': height_content,
		 		'top': '-'+height_content,
		 	});
		 });
	});	
</script>	
{% endblock script %}